import bancos from '../bancos.js'
import {tipo} from '../lib.js'

export default ({X, fixo, numero, texto, data, mapa}) => {
  fixo('00100000')
  fixo(' ', 9)
  fixo(tipo(X, 'cnpjcpf'), 1)
  numero(X, 'cnpjcpf', 14)
  texto(X, 'id', 20)
  numero(X, 'agencia', 6)
  numero(X, 'conta', 13)
  numero(X, 'dac', 1)
  texto(X, 'nome', 30)
  fixo('BANCO DO BRASIL S/A', 30)
  fixo(' ', 10)
  fixo('1')
  data(X, 'geracao', 8)
  texto(X, 'hora', 6)
  numero(X, 'sequencia', 6)
  fixo('050')
  fixo(' ', 74)
  fixo('\n')
  fixo('00100011C')
  mapa(X, 'servico', {
    '20': 'Pagamento a Fornecedor',
    '30': 'Pagamento de Salário',
    '98': 'Pagamentos Diversos'
  })
  mapa(X, 'pagamento', {
    '01': 'Conta Corrente',
    '03': 'DOC/TED',
    '05': 'Poupança',
    '41': 'TED Outra Titularidade',
    '43': 'TED Mesma Titularidade'
  })
  fixo('031', 4)
  fixo(tipo(X, 'cnpjcpf'), 1)
  fixo(X.cnpjcpf, 14)
  fixo(X.id, 20)
  fixo(X.agencia, 6, true)
  fixo(X.conta, 13, true)
  fixo(X.dac, 1, true)
  fixo(X.nome, 30)
  fixo(' ', 40)
  texto(X, 'endereco', 30)
  texto(X, 'numero', 5)
  texto(X, 'complemento', 15)
  texto(X, 'cidade', 20)
  texto(X, 'cep', 8)
  texto(X, 'uf', 2)
  fixo(' ', 8)
  fixo('V.PAG10135', 10)
  fixo('\n')
  X.registros.forEach((R, index) => {
    fixo('00100013')
    fixo(index * 2 + 1, 5, true)
    fixo('A000000')
    fixo('001')
    numero(R, 'agencia', 6)
    numero(R, 'conta', 13)
    fixo(' ')
    texto(R, 'nome', 30)
    texto(R, 'documento', 20)
    data(R, 'vencimento', 8)
    fixo('BRL', 3)
    fixo('0', 15)
    numero(R, 'valor', 15, 2)
    fixo(' ', 20)
    fixo('0', 23)
    fixo(' ', 52)
    fixo('0')
    fixo(' ', 10)
    fixo('\n')
    fixo('00100013')
    fixo(index * 2 + 2, 5, true)
    fixo('B   ')
    fixo(tipo(R, 'cnpjcpf'), 1)
    texto(R, 'cnpjcpf', 14)
    fixo(' ', 95)
    data(R, 'vencimento', 8)
    numero(R, 'valor', 15, 2)
    fixo(' ', 90)
    fixo('\n')
  })
  fixo('00100015')
  fixo(' ', 9)
  fixo(X.registros.length * 2 + 2, 6, true)
  fixo(Math.round(100 * X.registros.reduce(
    (total, {valor}) => total + valor
  , 0)), 18, true)
  fixo(' ', 199)
  fixo('\n')
  fixo('00199999')
  fixo(' ', 9)
  fixo('000001')
  fixo(X.registros.length * 2 + 4, 6, true)
  fixo(' ', 211)
  fixo('\n')
}
